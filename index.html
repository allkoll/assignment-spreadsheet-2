<!DOCTYPE html>
<html>
<head>
    <title>Flipped Assignment Spreadsheet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        #controls {
            margin-bottom: 20px;
            text-align: center;
        }
        #controls button {
            margin: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
        }
        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
        }
        th[contenteditable="true"]:focus, td[contenteditable="true"]:focus {
            outline: 2px solid blue;
        }
        .score-select, .skill-select {
            width: 100%;
            padding: 2px;
            color: #000;
            font-weight: bold;
            border: none;
            outline: none;
            appearance: none;
        }
        .score-4 {
            background-color: #00c5ff;
        }
        .score-3 {
            background-color: #00ff04;
        }
        .score-2 {
            background-color: #fdff00;
        }
        .score-1 {
            background-color: #ff1837;
        }
        .score-N {
            background-color: #ff00a7;
        }
        .score-default {
            background-color: #cccccc;
        }
        .chart-cell {
            width: 150px;
        }
        #downloadBtn {
            display: block;
            margin: 20px auto;
        }
        .proficiency-cell {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .letter-grade {
            font-weight: bold;
        }
        .rotate-header {
            transform: rotate(-90deg);
            writing-mode: vertical-lr;
            white-space: nowrap;
            height: 150px;
        }
        .sep-averages-row th {
            text-align: left;
        }
        .sep-average {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Flipped Assignment Spreadsheet</h1>

    <div id="controls">
        <button id="addStudentBtn">Add Student</button>
        <button id="addAssessmentBtn">Add Assessment</button>
        <button id="downloadBtn">Download PDF</button>
    </div>

    <table id="gradeTable">
        <thead>
            <tr id="assessmentRow">
                <th>Assessment Name</th>
                <!-- Assessments will be added here -->
            </tr>
            <tr id="skillRow">
                <th>Skill Name</th>
                <!-- Skills will be added here -->
            </tr>
            <tr id="proficiencyRow">
                <th>% Proficient</th>
                <!-- Proficiency percentages will be added here -->
            </tr>
            <tr id="letterGradeRow">
                <th>Letter Grade</th>
                <!-- Letter grades will be added here -->
            </tr>
        </thead>
        <tbody>
            <!-- Student rows will be added here -->
        </tbody>
    </table>

    <!-- Include Chart.js and jsPDF from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf"></script>

    <script>
        const gradeTable = document.getElementById('gradeTable');
        const assessmentRow = document.getElementById('assessmentRow');
        const skillRow = document.getElementById('skillRow');
        const proficiencyRow = document.getElementById('proficiencyRow');
        const letterGradeRow = document.getElementById('letterGradeRow');
        let assessments = [];
        let students = [];

        // Function to initialize the table with sample data
        function initializeTable() {
            for (let i = 1; i <= 10; i++) {
                addStudent('Student ' + i);
            }
            for (let i = 0; i < 10; i++) {
                addAssessment('Assessment ' + (i + 1), 'Skill ' + (i + 1));
            }
        }

        // Function to add an assessment
        function addAssessment(assessmentName, skillName) {
            const assessmentIndex = assessments.length;
            assessments.push({ name: assessmentName, skill: skillName });

            // Add assessment name
            const assessmentCell = document.createElement('th');
            assessmentCell.contentEditable = true;
            assessmentCell.textContent = assessmentName;
            assessmentRow.appendChild(assessmentCell);

            // Add skill name
            const skillCell = document.createElement('th');
            skillCell.contentEditable = true;
            skillCell.textContent = skillName;
            skillRow.appendChild(skillCell);

            // Add proficiency percentage
            const proficiencyCell = document.createElement('td');
            proficiencyCell.className = 'proficiency-cell';
            proficiencyCell.textContent = '0%';
            proficiencyRow.appendChild(proficiencyCell);

            // Add score cells for students
            students.forEach((student, studentIndex) => {
                const scoreCell = createScoreCell(studentIndex, assessmentIndex);
                gradeTable.querySelector('tbody').rows[studentIndex].appendChild(scoreCell);
            });

            // Add letter grade cells
            updateLetterGrades();
        }

        // Function to add a student
        function addStudent(studentName) {
            const studentIndex = students.length;
            students.push({ name: studentName });

            const row = document.createElement('tr');
            const nameCell = document.createElement('th');
            nameCell.textContent = studentName;
            row.appendChild(nameCell);
            gradeTable.querySelector('tbody').appendChild(row);

            // Add score cells for existing assessments
            assessments.forEach((assessment, assessmentIndex) => {
                const scoreCell = createScoreCell(studentIndex, assessmentIndex);
                row.appendChild(scoreCell);
            });
        }

        // Function to create a score cell
        function createScoreCell(studentIndex, assessmentIndex) {
            const scoreCell = document.createElement('td');
            const select = document.createElement('select');
            select.className = 'score-select';
            const scores = ['', 4, 3, 2, 1, 'N'];
            scores.forEach(score => {
                const option = document.createElement('option');
                option.value = score;
                option.textContent = score;
                select.appendChild(option);
            });

            select.addEventListener('change', function() {
                updateProficiencyPercentages();
                updateLetterGrades();
            });

            scoreCell.appendChild(select);
            return scoreCell;
        }

        // Function to update letter grades
        function updateLetterGrades() {
            students.forEach((student, studentIndex) => {
                const row = gradeTable.querySelector('tbody').rows[studentIndex];
                const scores = [...row.querySelectorAll('select')].map(select => select.value);
                const avg = calculateAverage(scores);
                const letterGrade = getLetterGrade(avg);
                letterGradeRow.querySelectorAll('td')[studentIndex].textContent = letterGrade;
            });
        }

        // Function to calculate average score
        function calculateAverage(scores) {
            const validScores = scores.filter(score => score !== '').map(Number);
            return validScores.length ? validScores.reduce((a, b) => a + b) / validScores.length : 0;
        }

        // Function to return letter grade
        function getLetterGrade(avg) {
            if (avg >= 3.5) return 'A';
            if (avg >= 2.5) return 'B';
            if (avg >= 1.5) return 'C';
            return 'F';
        }

        // Function to update proficiency percentages
        function updateProficiencyPercentages() {
            assessments.forEach((assessment, assessmentIndex) => {
                let total = 0;
                let proficient = 0;
                students.forEach((student, studentIndex) => {
                    const score = gradeTable.querySelector('tbody').rows[studentIndex].querySelectorAll('select')[assessmentIndex].value;
                    if (score !== '') {
                        total++;
                        if (score == '4' || score == '3') proficient++;
                    }
                });
                const proficiency = total ? (proficient / total * 100).toFixed(2) + '%' : '0%';
                proficiencyRow.querySelectorAll('td')[assessmentIndex].textContent = proficiency;
            });
        }

        // Initialize the table with sample data
        initializeTable();
    </script>
</body>
</html>
